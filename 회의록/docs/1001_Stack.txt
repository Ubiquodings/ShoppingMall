

[개발 관련 Todo]

** 소켓 헤더 공통 설계하자!
* 현재는 일부 소켓 커트롤러에서 상품 열람 처리하는데
*  채팅방 입장하듯 다시 설계하기!
* 읽기랑 쓰기 분리하기!!

- 상품 목록을 보고있을 때도 사람 수 증가시키기
- 각 js 마다 헤더 플래그 구성해야 하나 ?
* 채팅방 입장하듯 바꾸는거 말이야
* 그냥 소켓 컨트롤러에서 db 증가하고 get 하면 안되나 ? 해보자!
* config 소켓 다 주석하고
# 그래도 채팅방 입장 소켓 2가지밖에 없는데 기존 설계 그대로 가보자!


- 소켓 화면
ok  - 화면 밑에 파일 포함하기
  - 소켓 화면 코드 작성하기


소켓 기능 연동
- 상품 구매 : order-number
ok- 상품 구매 후 db 변화 확인
ok- 상품 구매 사용자수 화면 코드
ok- 소켓 서버
ok- 상품 구매 사용자수 변경되면 서버 브로드캐스팅 테스트
* 대시보드 확인하기
장바구니

쿠폰목록 << 요거 하는중!
  - 상품 관련 쿠폰이면 상품 구매한 사용자 수
  - 쿠폰사용 소켓 연결하기
  
ok결재페이지
ok주문목록

* 상품열람 productUserNumber
* 상품구매 productOrderUserNumber

* 쿠폰사용

- 쿠폰 사용 : coupon-use

- 소켓 사용자 수 일괄 갱신


- 추천 알고리즘 먼저 세팅
- itemCF 는 상품 태그 위주로, 키워드 유사도 연산할거야
  - 이건 한 번 하면 변하지 않지
- userCF 는 score 위주로, 주기적 갱신할거야
  - 이건 주기적으로 갱신해야 한다

- 추천 목록 코드 세팅하기
- 쿠폰 코드 세팅하기

* 배열 땡겨오는 부분 class&id 맞게 html 수정해야 함!
  * js 코드도 함께 수정할것!

* subscribe 개수 == send 개수
* 그런데 나도 알겠지만
변수가 여러개이면 배열 땡겨와서 
루프 돌며 구독&요청 해야한다!


> 사용자 수 종류 : 소켓 동작

채팅방 연결하는 것처럼. 후 일괄 갱신
* 소켓 헤더 부분 설계하기
- 상품 상세 페이지 : ProductView
- 모든 페이지 : AllView
  요건 사용자 어떻게 관리/집계 ?


- 쿠폰 type 관련 모델링 수정중
쿠폰 종류:type가 3가지 있는거고
- product base
- category base
  * 특별히 coupon type+_+category coupon type 으로 
  * type 구분
- all around
각 종류당 product id, category id 가 있을거고


- 주문 목록 ajax 처리해야 한다
  - 대시보드 참고하면서


- 쿠폰 관련해서 소켓 이용할거면
SocketCouponController 생성하기


- 추천 목록 갱신
  - 추천 로직 기존 것 그대로 가져올 코드 확보
  - 우리 쇼핑몰에서 어떻게 이용할지 
  - 장고에 코드 옮기기

  - 스부에서 스케줄링:주기적 작업 세팅하기 (분석)
  - 주기적 작업
    - 스부 > 장고 : userCF 분석 요청


  - item CF 는 어떻게 할 것인가
    - 형태소 분석한 text 기반으로 키워드 유사도 연산 (기존 로직)
      * 현재로썬 태그 정도


- 검색 기능
  * es : aws 에 배포 후 테스트해보기


- 스부 > 장고 : 데이터 분석 요청
  - 상품을 누를 때마다 요청
  - 이 소켓을 화면 이동할 때마다 구독해서 알림 받기
    * 화면을 이동하는 와중에 못받을수도 있겠구나 ?
    - 아니지 카프카 컨슈머에서 db 에 저장하고
    - 알림이 갔는지 아닌지 flag 확인하고 alert 주기 혹은 배지



> 카프카 수집 로직 마무리하기
String action = "order-create";
buildKafkaRequest(userId, product, action);

# 쿠폰 관련 카프카 로직 새로 생성해야할듯!
# 근데 쿠폰 관련 정보를 추천에 어떻게 이용할지 먼저 생각하고 
# 카프카 통해서 수집할지 결정해야 할거같아
# 수집할거면 어떻게 수집할건지 dto 모델링해야할듯
- coupon-create
- coupon-use


- 추가로 소켓도 카프카와 연동하기
  - kafka request dto 모델링해야한다
  - 일단 한꺼번에 카프카로 연동하자
  - 사용자수, 추천목록 (쿠폰은 db 로 연동하자




 
================================
================================
====== Done Stack ================
================================

[개발 외 Todo]
- 보고서 보완
  - 수정 사항 적을 공간 확보
  - 작품 소개 보완
  - 그 외 카프카 등 강조할 부분 영어로 표현
  - 작품 특장점 보완
  - 문제점 및 해결방안 검토
  * 등 유연언니 .md 파일 참고

- 조금 나중의 일이지만) 한이음 2차 영상 제작


> 카프카 수집 로직 마무리하기
String action = "order-create";
buildKafkaRequest(userId, product, action);

- click
- hover
- cart-create
- order-create
- order-cancel
- cart-cancel
- cart-modify-plus
- cart-modify-minus


> 사용자 수 종류 : 모델링 할건데, 저장 

* 도메인 객체 만든거
* repo 인터페이스 만들어야 한다!
ProductViewUserNumberRepository
AllViewUserNumberRepository
ProductOrderUserNumberRepository
CouponUseUserNumberRepository

1- 각 상품 함께 열람하고 있는 사용자 수
클래스이름: ProductViewUserNumberDto
기존 UpdateUserNumberDto
long productId, long userNumber

2- [공통] 쇼핑몰에 접속한 전체 사용자 수
클래스이름: AllViewUserNumberDto
long userNumber

3- 각 상품 구매한 사용자 수
클래스이름: ProductOrderUserNumberDto
long productId, long userNumber

4- 각 쿠폰 사용한 사용자 수 : 각 쿠폰당 고유 type 부여하기
클래스이름: CouponUseUserNumberDto
String couponType, long userNumber


dashboard.js
dash-and-product-detail.js
product-list-and-detail.js
order-number.js
buy-together.js
coupon-use.js


접속한 전체 사용자 수
/app/users/root
/topic/users/root

해당상품 구매한 사람수
/app/users/ordered/{productId}
/topic/users/ordered/{productId}

해당 쿠폰 사용한 사람 수
/app/users/coupons/{couponType}
/topic/users/coupons/{couponType}


- 소켓:사용자 수 관련
ok  - 모델링
ok  - 사용자 수 변경 후 소켓 브로드캐스팅 코드

ok- 기존 코드 옮기기
ok- 사용자 수 코드 세팅하기


- 소켓:사용자 수 관련
ok  - 화면 로딩 후 소켓 구독 연결
ok    * 이게 되면 상품 및 추천 목록도 구현 가능해진다
* 상품 상세 페이지에서 받았고, UI 는 없는 상태!

